<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GENETIC AI</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#000; color:#fff; height:100vh; display:flex; flex-direction:column; }
    header { height:50px; background:#001f33; color:#00aaff; display:flex; align-items:center; padding:0 15px; font-weight:bold; box-shadow:0 0 10px #00aaff; }
    #app { flex:1; display:flex; height:calc(100vh - 50px); }
    #sidebar { width:260px; background:#001122; border-right:1px solid #003366; display:flex; flex-direction:column; padding:15px; box-sizing:border-box; }
    #sidebar h2 { margin:10px 0; color:#00aaff; font-size:15px; border-bottom:1px solid #003366; padding-bottom:4px; }
    #conversation-list { flex:1; overflow-y:auto; margin:10px 0; }
    .conv { padding:10px; margin:6px 0; background:#002244; border-radius:8px; cursor:pointer; font-size:14px; display:flex; justify-content:space-between; align-items:center; }
    .conv span { flex:1; }
    .conv button { background:none; border:none; color:#00ffaa; cursor:pointer; font-size:14px; }
    .conv:hover { background:#003366; }
    #account-section button { padding:10px; border:none; border-radius:6px; background:#00aaff; color:#fff; cursor:pointer; margin-top:10px; width:100%; font-weight:bold; }
    #chat-container { flex:1; display:flex; flex-direction:column; background:#000814; }
    #chat-box { flex:1; padding:20px; overflow-y:auto; }
    .message { margin:10px 0; padding:12px; border-radius:12px; max-width:70%; font-size:14px; line-height:1.4; box-shadow:0 0 6px rgba(0,170,255,0.2); }
    .message span.time { font-size:10px; opacity:0.6; display:block; margin-top:4px; text-align:right; }
    .user { background:#003366; margin-left:auto; border-bottom-right-radius:2px; }
    .bot { background:#001f33; margin-right:auto; border-bottom-left-radius:2px; }
    .typing-indicator { margin:8px 0; padding:10px; border-radius:8px; background:#001f33; margin-right:auto; width:60px; text-align:center; }
    .dot { display:inline-block; width:6px; height:6px; margin:0 2px; background:#00ffaa; border-radius:50%; animation:blink 1.4s infinite; }
    .dot:nth-child(2){animation-delay:.2s;} .dot:nth-child(3){animation-delay:.4s;}
    @keyframes blink {0%,80%,100%{opacity:0;}40%{opacity:1;}}
    .input-area { display:flex; padding:12px; border-top:1px solid #003366; background:#000c1a; }
    .input-area input { flex:1; padding:12px; border-radius:8px; border:none; background:#111; color:white; }
    .input-area button { margin-left:10px; padding:12px 18px; border:none; border-radius:8px; background:#00aaff; color:white; font-weight:bold; }
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); justify-content:center; align-items:center; z-index:1000; }
    .modal-content { background:#001122; padding:20px; border-radius:12px; width:300px; text-align:center; }
    .modal-content input { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:none; background:#111; color:#fff; }
    .modal-content button { width:100%; padding:12px; background:#00aaff; color:white; border:none; border-radius:6px; cursor:pointer; margin-top:10px; }
    #splash { position:fixed; top:0; left:0; width:100%; height:100%; background:black; display:flex; justify-content:center; align-items:center; color:#00aaff; font-size:32px; font-weight:bold; text-shadow:0 0 15px #00aaff; z-index:2000; }
    #splash.fade-out{animation:fadeOut 1s forwards;} @keyframes fadeOut{to{opacity:0;visibility:hidden;}}
  </style>
</head>
<body>
  <div id="splash">GENETIC AI</div>
  <header>GENETIC AI</header>
  <div id="app">
    <div id="sidebar">
      <h2>Conversations</h2>
      <button onclick="newConversation()">+ New Chat</button>
      <div id="conversation-list"></div>
      <h2>Account</h2>
      <div id="account-section"><button onclick="openAuthModal()">Create / Login</button></div>
    </div>
    <div id="chat-container">
      <div id="chat-box"></div>
      <div class="input-area">
        <input type="text" id="user-input" placeholder="Type your message..."/>
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div id="authModal" class="modal">
    <div class="modal-content">
      <h2>Account</h2>
      <input type="text" id="name" placeholder="Name (signup only)"/>
      <input type="email" id="email" placeholder="Email"/>
      <input type="password" id="password" placeholder="Password"/>
      <button onclick="createAccount()">Sign Up</button>
      <button onclick="login()">Login</button>
      <button onclick="closeModal('authModal')">Cancel</button>
    </div>
  </div>

  <!-- Profile Modal -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <h2>Profile</h2>
      <p id="profileName"></p>
      <p id="profileEmail"></p>
      <button onclick="logout()">Logout</button>
      <button onclick="closeModal('profileModal')">Close</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCTHzW_H6NGje1eabCVxpzjC_HBfO2yrSA",
      authDomain: "genetic-ai.firebaseapp.com",
      projectId: "genetic-ai",
      storageBucket: "genetic-ai.appspot.com",
      messagingSenderId: "470283209918",
      appId: "1:470283209918:web:80f6043ab283713fb362ef"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const chatBox=document.getElementById("chat-box");
    const convList=document.getElementById("conversation-list");
    const accountSection=document.getElementById("account-section");
    let currentUser=null, currentConversation=null;

    function formatTime(ts){if(!ts)return"";let d=ts.toDate?ts.toDate():new Date(ts);return d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});}
    function appendMessage(sender,text,ts=new Date()){const div=document.createElement("div");div.classList.add("message",sender);div.innerHTML=`${text}<span class="time">${formatTime(ts)}</span>`;chatBox.appendChild(div);chatBox.scrollTop=chatBox.scrollHeight;}
    function showTyping(){const div=document.createElement("div");div.classList.add("typing-indicator");div.innerHTML='<span class="dot"></span><span class="dot"></span><span class="dot"></span>';chatBox.appendChild(div);chatBox.scrollTop=chatBox.scrollHeight;return div;}

    async function sendMessage(){
      const input=document.getElementById("user-input");
      const message=input.value.trim();
      if(!message)return;
      if(!currentConversation)await newConversation(message);
      appendMessage("user",message);
      input.value="";
      const typingDiv=showTyping();
      try{
        const res=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyB38wSJgAAjsQT8929WGukCsd98pV3V1kY",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:message}]}]})});
        const data=await res.json();typingDiv.remove();
        const reply=data?.candidates?.[0]?.content?.parts?.[0]?.text||"⚠️ No internet connection";
        let i=0;const botDiv=document.createElement("div");botDiv.classList.add("message","bot");chatBox.appendChild(botDiv);
        const typeInt=setInterval(()=>{botDiv.innerHTML=reply.slice(0,i+1)+`<span class="time">${formatTime()}</span>`;chatBox.scrollTop=chatBox.scrollHeight;if(++i>=reply.length)clearInterval(typeInt);},30);
        if(currentUser){const convRef=db.collection("users").doc(currentUser.uid).collection("conversations").doc(currentConversation);await convRef.collection("messages").add({sender:"user",text:message,time:new Date()});await convRef.collection("messages").add({sender:"bot",text:reply,time:new Date()});}
      }catch{typingDiv.remove();appendMessage("bot","⚠️ No internet connection");}
    }

    async function newConversation(firstMsg=""){
      if(!currentUser){alert("Login first");return;}
      const id="conv-"+Date.now();
      const title=firstMsg?firstMsg.split(" ").slice(0,5).join(" "):"New Chat";
      await db.collection("users").doc(currentUser.uid).collection("conversations").doc(id).set({title,createdAt:new Date()});
      loadConversations(currentUser.uid);
      currentConversation=id;
      chatBox.innerHTML="";
    }

    function renameConversation(uid,convId,oldTitle){
      const newTitle=prompt("Rename conversation:",oldTitle);
      if(newTitle){db.collection("users").doc(uid).collection("conversations").doc(convId).update({title:newTitle});}
    }

    function loadConversations(uid){
      convList.innerHTML="";
      db.collection("users").doc(uid).collection("conversations").orderBy("createdAt","desc").onSnapshot(snap=>{
        convList.innerHTML="";
        snap.forEach(doc=>{
          const div=document.createElement("div");
          div.classList.add("conv");
          const span=document.createElement("span");
          span.textContent=doc.data().title;
          div.appendChild(span);
          const btn=document.createElement("button");
          btn.textContent="✏️";
          btn.onclick=(e)=>{e.stopPropagation();renameConversation(uid,doc.id,doc.data().title)};
          div.appendChild(btn);
          div.onclick=()=>loadMessages(uid,doc.id);
          convList.appendChild(div);
        });
      });
    }

    function loadMessages(uid,convId){
      currentConversation=convId;
      chatBox.innerHTML="";
      db.collection("users").doc(uid).collection("conversations").doc(convId).collection("messages").orderBy("time").onSnapshot(snap=>{
        chatBox.innerHTML="";
        snap.forEach(m=>appendMessage(m.data().sender,m.data().text,m.data().time));
      });
    }

    function openAuthModal(){document.getElementById("authModal").style.display="flex";}
    function openProfileModal(){document.getElementById("profileModal").style.display="flex";}
    function closeModal(id){document.getElementById(id).style.display="none";}

    async function createAccount(){const name=document.getElementById("name").value,email=document.getElementById("email").value,password=document.getElementById("password").value;try{const userCred=await auth.createUserWithEmailAndPassword(email,password);await db.collection("users").doc(userCred.user.uid).set({name,email,createdAt:new Date()});}catch(e){alert(e.message);}closeModal("authModal");}
    async function login(){const email=document.getElementById("email").value,password=document.getElementById("password").value;try{await auth.signInWithEmailAndPassword(email,password);}catch(e){alert(e.message);}closeModal("authModal");}
    function logout(){auth.signOut();closeModal("profileModal");}

    auth.onAuthStateChanged(async user=>{
      if(user){currentUser=user;const doc=await db.collection("users").doc(user.uid).get();const displayName=doc.exists?doc.data().name:user.email;accountSection.innerHTML=`<p>Welcome, ${user.email}</p><button onclick="openProfileModal()">Profile</button>`;document.getElementById("profileName").textContent="Name: "+displayName;document.getElementById("profileEmail").textContent="Email: "+user.email;loadConversations(user.uid);}
      else{currentUser=null;currentConversation=null;accountSection.innerHTML='<button onclick="openAuthModal()">Create / Login</button>';convList.innerHTML="";}
    });

    window.onload=()=>{setTimeout(()=>{document.getElementById("splash").classList.add("fade-out");},2000);}
  </script>
</body>
      </html>
